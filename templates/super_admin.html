<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin - Student Care</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Kanit', sans-serif; background: #f5f7fa; }
        .navbar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; }
        .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        .stat-card h3 { font-size: 48px; color: #667eea; margin: 10px 0; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { background: #f8f9fa; font-weight: 600; }
        .badge { padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: 600; }
        .badge-active { background: #d4edda; color: #155724; }
        .badge-expired { background: #f8d7da; color: #721c24; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { background: white; width: 90%; max-width: 800px; margin: 50px auto; border-radius: 20px; padding: 40px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .close-btn { font-size: 32px; cursor: pointer; color: #999; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: 'Kanit', sans-serif; font-size: 16px; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .package-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 10px; }
        .package-card { border: 3px solid #e0e0e0; padding: 20px; border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .package-card:hover { border-color: #667eea; transform: translateY(-5px); }
        .package-card.selected { border-color: #667eea; background: #f0f4ff; }
        .package-card h4 { color: #667eea; margin-bottom: 10px; font-size: 20px; }
        .package-card .price { font-size: 24px; font-weight: 700; color: #333; margin: 10px 0; }
        .package-card .capacity { color: #666; font-size: 14px; }
        .full-width { grid-column: 1 / -1; }
        .tab-buttons { display: flex; gap: 15px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1>üëë Super Admin Dashboard</h1>
        <div>
            <span>SOFTUBON CO.,LTD.</span> | 
            <a href="/logout" style="color: white;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
    </nav>

    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <p>üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <h3>{{ stats.total_schools or 0 }}</h3>
            </div>
            <div class="stat-card">
                <p>ü§ù Reseller/Partner</p>
                <h3>{{ stats.total_resellers or 0 }}</h3>
            </div>
            <div class="stat-card">
                <p>üë• ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <h3>{{ stats.total_capacity or 0 }}</h3>
            </div>
            <div class="stat-card">
                <p>‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</p>
                <h3>{{ stats.expiring_soon or 0 }}</h3>
            </div>
        </div>

        <div class="tab-buttons">
            <button class="btn" id="btnSchools" onclick="showTab('schools')">üè´ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
            <button class="btn" id="btnResellers" onclick="showTab('resellers')" style="background: #6c757d;">ü§ù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Reseller</button>
        </div>

        <div id="schoolsTab" class="card">
            <h2>üè´ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
            <button class="btn" onclick="openAddSchoolModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
            
            <table>
                <thead>
                    <tr>
                        <th>‡∏£‡∏´‡∏±‡∏™</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                        <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
                        <th>‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡πá‡∏à</th>
                        <th>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</th>
                        <th>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    {% if schools %}
                        {% for school in schools %}
                        <tr>
                            <td>{{ school.school_id }}</td>
                            <td><strong>{{ school.name }}</strong></td>
                            <td>{{ school.province or '-' }}</td>
                            <td>{{ school.package }}</td>
                            <td>{{ school.max_students }}</td>
                            <td>{{ school.expire_date }}</td>
                            <td>
                                <span class="badge badge-{{ 'active' if school.status == 'active' else 'expired' }}">
                                    {{ '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' if school.status == 'active' else '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏' }}
                                </span>
                            </td>
                            <td><button class="btn" onclick="editSchool('{{ school.school_id }}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr><td colspan="8" style="text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</td></tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <div id="resellersTab" class="card" style="display: none;">
            <h2>ü§ù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Reseller / Partner</h2>
            <button class="btn" onclick="openAddResellerModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏° Reseller ‡πÉ‡∏´‡∏°‡πà</button>
            
            <table>
                <thead>
                    <tr>
                        <th>‡∏£‡∏´‡∏±‡∏™</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</th>
                        <th>‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡πá‡∏à</th>
                        <th>‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ/‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß</th>
                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                        <th>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="8" style="text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Reseller</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
    <div id="addSchoolModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
                <span class="close-btn" onclick="closeModal()">&times;</span>
            </div>
            
            <form id="addSchoolForm" onsubmit="submitSchool(event)">
                <div class="form-group full-width">
                    <label>üì¶ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡πá‡∏à *</label>
                    <div class="package-cards">
                        <div class="package-card" onclick="selectPackage('Starter', 100, 990, 9900, 84000)">
                            <div style="font-size: 36px;">üè´</div>
                            <h4>Starter</h4>
                            <div class="capacity">1-100 ‡∏Ñ‡∏ô</div>
                            <div class="price">‡∏ø990/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            <div style="font-size: 12px; color: #999;">‡∏ø9,900/‡∏õ‡∏µ | ‡∏ø84,000 ‡∏Ç‡∏≤‡∏î</div>
                        </div>
                        <div class="package-card" onclick="selectPackage('Professional', 500, 2990, 29900, 251000)">
                            <div style="font-size: 36px;">üè´</div>
                            <h4>Professional</h4>
                            <div class="capacity">101-500 ‡∏Ñ‡∏ô</div>
                            <div class="price">‡∏ø2,990/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            <div style="font-size: 12px; color: #999;">‡∏ø29,900/‡∏õ‡∏µ | ‡∏ø251,000 ‡∏Ç‡∏≤‡∏î</div>
                        </div>
                        <div class="package-card" onclick="selectPackage('Business', 2000, 7990, 79900, 671000)">
                            <div style="font-size: 36px;">üè´</div>
                            <h4>Business</h4>
                            <div class="capacity">501-2,000 ‡∏Ñ‡∏ô</div>
                            <div class="price">‡∏ø7,990/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            <div style="font-size: 12px; color: #999;">‡∏ø79,900/‡∏õ‡∏µ | ‡∏ø671,000 ‡∏Ç‡∏≤‡∏î</div>
                        </div>
                    </div>
                    <input type="hidden" id="package" name="package" required>
                    <input type="hidden" id="maxStudents" name="max_students" required>
                </div>

                <div class="form-group full-width">
                    <label>üí≥ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô *</label>
                    <select id="paymentType" onchange="updatePricing()" required>
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
                        <option value="monthly">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                        <option value="yearly">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î 17%)</option>
                        <option value="lifetime">‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≤‡∏î (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î 30%)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="price" readonly style="background: #f8f9fa;">
                </div>

                <div class="form-group">
                    <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ *</label>
                    <input type="date" id="expireDate" name="expire_date" required>
                </div>

                <div class="form-group full-width">
                    <label>üè´ ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label>
                    <input type="text" id="schoolName" name="name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏ß‡∏ô" required>
                </div>

                <div class="form-group">
                    <label>üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î *</label>
                    <input type="text" id="province" name="province" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£" required>
                </div>

                <div class="form-group">
                    <label>üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                    <input type="tel" id="phone" name="phone" placeholder="02-xxx-xxxx">
                </div>

                <div class="form-group">
                    <label>üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input type="email" id="email" name="email" placeholder="school@example.com">
                </div>

                <div class="form-group">
                    <label>üåê ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</label>
                    <input type="url" id="website" name="website" placeholder="https://school.ac.th">
                </div>

                <div class="form-group full-width">
                    <label>üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <input type="text" id="notes" name="notes" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°">
                </div>

                <hr style="margin: 30px 0; border: none; border-top: 2px solid #e0e0e0;">
                <h3 style="margin-bottom: 20px;">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Admin ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>

                <div class="form-group">
                    <label>üë§ Username *</label>
                    <input type="text" id="adminUsername" name="admin_username" placeholder="admin" required>
                </div>

                <div class="form-group">
                    <label>üîí Password *</label>
                    <input type="password" id="adminPassword" name="admin_password" placeholder="********" required>
                </div>

                <div class="form-group full-width" style="margin-top: 30px;">
                    <button type="submit" class="btn" style="width: 100%; padding: 15px; font-size: 18px;">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal ‡πÄ‡∏û‡∏¥‡πà‡∏° Reseller -->
    <div id="addResellerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏° Reseller / Partner ‡πÉ‡∏´‡∏°‡πà</h2>
                <span class="close-btn" onclick="closeResellerModal()">&times;</span>
            </div>
            
            <form id="addResellerForm" onsubmit="submitReseller(event)">
                <div class="form-group full-width">
                    <label>üì¶ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡πá‡∏à Reseller *</label>
                    <div class="package-cards">
                        <div class="package-card" onclick="selectResellerPackage('Basic', 10, 450000)">
                            <div style="font-size: 36px;">üíº</div>
                            <h4>Reseller Basic</h4>
                            <div class="capacity">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ 10 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                            <div class="price">‡∏ø450,000</div>
                            <div style="font-size: 12px; color: #666;">‡∏Å‡∏≥‡πÑ‡∏£ 40-60%</div>
                        </div>
                        <div class="package-card" onclick="selectResellerPackage('Pro', 25, 850000)">
                            <div style="font-size: 36px;">üèÜ</div>
                            <h4>Reseller Pro</h4>
                            <div class="capacity">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ 25 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                            <div class="price">‡∏ø850,000</div>
                            <div style="font-size: 12px; color: #666;">‡∏Å‡∏≥‡πÑ‡∏£ 50-70%</div>
                        </div>
                        <div class="package-card" onclick="selectResellerPackage('Master', 999, 1500000)">
                            <div style="font-size: 36px;">üëë</div>
                            <h4>Master Partner</h4>
                            <div class="capacity">‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</div>
                            <div class="price">‡∏ø1,500,000</div>
                            <div style="font-size: 12px; color: #666;">‡∏Å‡∏≥‡πÑ‡∏£ 60-80%</div>
                        </div>
                    </div>
                    <input type="hidden" id="resellerPackage" name="package" required>
                    <input type="hidden" id="resellerMaxSchools" name="max_schools" required>
                    <input type="hidden" id="resellerPrice" name="price" required>
                </div>

                <div class="form-group full-width">
                    <label>üè¢ ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• *</label>
                    <input type="text" id="resellerName" name="name" placeholder="‡πÄ‡∏ä‡πà‡∏ô SOFTUBON CO.,LTD." required>
                </div>

                <div class="form-group">
                    <label>üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ *</label>
                    <input type="text" id="contactName" name="contact_name" placeholder="‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢" required>
                </div>

                <div class="form-group">
                    <label>üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *</label>
                    <input type="tel" id="resellerPhone" name="phone" placeholder="02-xxx-xxxx" required>
                </div>

                <div class="form-group">
                    <label>üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                    <input type="email" id="resellerEmail" name="email" placeholder="contact@company.com" required>
                </div>

                <div class="form-group">
                    <label>üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡πÄ‡∏Ç‡∏ï</label>
                    <input type="text" id="resellerRegion" name="region" placeholder="‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£">
                </div>

                <div class="form-group">
                    <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ *</label>
                    <input type="date" id="resellerExpireDate" name="expire_date" required>
                </div>

                <div class="form-group full-width">
                    <label>üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <input type="text" id="resellerNotes" name="notes" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°">
                </div>

                <hr style="margin: 30px 0; border: none; border-top: 2px solid #e0e0e0;">
                <h3 style="margin-bottom: 20px;">üîë ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>

                <div class="form-group">
                    <label>üë§ Username *</label>
                    <input type="text" id="resellerUsername" name="username" placeholder="reseller01" required>
                </div>

                <div class="form-group">
                    <label>üîí Password *</label>
                    <input type="password" id="resellerPassword" name="password" placeholder="********" required>
                </div>

                <div class="form-group full-width" style="margin-top: 30px;">
                    <button type="submit" class="btn" style="width: 100%; padding: 15px; font-size: 18px;">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Reseller</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let selectedPackageData = {};

        function showTab(tab) {
            if (tab === 'schools') {
                document.getElementById('schoolsTab').style.display = 'block';
                document.getElementById('resellersTab').style.display = 'none';
                document.getElementById('btnSchools').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                document.getElementById('btnResellers').style.background = '#6c757d';
            } else {
                document.getElementById('schoolsTab').style.display = 'none';
                document.getElementById('resellersTab').style.display = 'block';
                document.getElementById('btnSchools').style.background = '#6c757d';
                document.getElementById('btnResellers').style.background = 'linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%)';
            }
        }

        function selectPackage(name, capacity, monthly, yearly, lifetime) {
            document.querySelectorAll('#addSchoolModal .package-card').forEach(card => card.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            document.getElementById('package').value = name;
            document.getElementById('maxStudents').value = capacity;
            
            selectedPackageData = { name, monthly, yearly, lifetime };
            updatePricing();
            
            const expireDate = new Date();
            expireDate.setFullYear(expireDate.getFullYear() + 1);
            document.getElementById('expireDate').value = expireDate.toISOString().split('T')[0];
        }

        function updatePricing() {
            const paymentType = document.getElementById('paymentType').value;
            const priceInput = document.getElementById('price');
            
            if (!selectedPackageData.name || !paymentType) {
                priceInput.value = '';
                return;
            }
            
            const prices = {
                monthly: selectedPackageData.monthly,
                yearly: selectedPackageData.yearly,
                lifetime: selectedPackageData.lifetime
            };
            
            priceInput.value = prices[paymentType] || '';
        }

        function openAddSchoolModal() {
            document.getElementById('addSchoolModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('addSchoolModal').style.display = 'none';
            document.getElementById('addSchoolForm').reset();
            document.querySelectorAll('#addSchoolModal .package-card').forEach(card => card.classList.remove('selected'));
            selectedPackageData = {};
        }

        function submitSchool(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            data.max_students = parseInt(data.max_students);
            data.payment_type = document.getElementById('paymentType').value;
            data.price = parseInt(document.getElementById('price').value);
            
            fetch('/api/schools', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ' + data.school_id + '\nUsername: ' + data.admin_username);
                    closeModal();
                    location.reload();
                } else {
                    alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message);
                }
            })
            .catch(err => {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
            });
        }

        // Reseller Functions
        let selectedResellerData = {};

        function selectResellerPackage(name, maxSchools, price) {
            document.querySelectorAll('#addResellerModal .package-card').forEach(card => card.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            document.getElementById('resellerPackage').value = name;
            document.getElementById('resellerMaxSchools').value = maxSchools;
            document.getElementById('resellerPrice').value = price;
            
            selectedResellerData = { name, maxSchools, price };
            
            const expireDate = new Date();
            expireDate.setFullYear(expireDate.getFullYear() + 3);
            document.getElementById('resellerExpireDate').value = expireDate.toISOString().split('T')[0];
        }

        function openAddResellerModal() {
            document.getElementById('addResellerModal').style.display = 'block';
        }

        function closeResellerModal() {
            document.getElementById('addResellerModal').style.display = 'none';
            document.getElementById('addResellerForm').reset();
            document.querySelectorAll('#addResellerModal .package-card').forEach(card => card.classList.remove('selected'));
            selectedResellerData = {};
        }

        function submitReseller(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            data.max_schools = parseInt(data.max_schools);
            data.price = parseInt(data.price);
            data.schools_used = 0;
            
            fetch('/api/resellers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Reseller ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏£‡∏´‡∏±‡∏™: ' + data.reseller_id + '\nUsername: ' + data.username + '\n‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ' + data.max_schools + ' ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô');
                    closeResellerModal();
                    location.reload();
                } else {
                    alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message);
                }
            })
            .catch(err => {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
            });
        }
        
        function editSchool(schoolId) {
            alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤');
        }
    </script>
</body>
</html>
