<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - Student Care System</title>
    <link rel="stylesheet" href="/static/responsive.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
        .layout { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 280px; background: linear-gradient(180deg, #667eea 0%, #764ba2 100%); color: white; position: fixed; height: 100vh; overflow-y: auto; }
        .sidebar-header { padding: 25px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-logo { font-size: 1.5em; font-weight: bold; }
        .menu-item { padding: 12px 20px; display: flex; align-items: center; gap: 12px; color: white; text-decoration: none; transition: all 0.3s; }
        .menu-item:hover { background: rgba(255,255,255,0.1); }
        .menu-item.active { background: rgba(255,255,255,0.2); }
        
        /* Main */
        .main-content { margin-left: 280px; flex: 1; }
        .topbar { background: white; padding: 20px 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .topbar-title { font-size: 1.8em; color: #333; }
        .logout-btn { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; text-decoration: none; }

        .container { max-width: 100%; margin: 0; padding: 30px; }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 2em;
            color: #333;
            margin-bottom: 10px;
        }

        .import-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .method-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .method-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .method-card.active {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .method-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .method-title {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .method-desc {
            color: #666;
            line-height: 1.6;
        }

        .import-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: none;
        }

        .import-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .file-upload {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            background: #f8f9ff;
        }

        .file-upload input {
            display: none;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .preview-table th,
        .preview-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .preview-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            text-decoration: none;
        }

        .back-btn:hover {
            background: white;
            color: #667eea;
        }

        .code-example {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .code-example pre {
            margin: 0;
        }

        @media (max-width: 768px) {
            .import-methods {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üéì Student Care</div>
            </div>
            <a href="/admin" class="menu-item"><span>üìä</span> Dashboard</a>
            <a href="/register" class="menu-item"><span>üì∏</span> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</a>
            <a href="/import_students" class="menu-item active"><span>üì•</span> ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
            <a href="/camera_classroom" class="menu-item"><span>üé•</span> ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</a>
            <a href="/reports" class="menu-item"><span>üìä</span> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="topbar">
                <div class="topbar-title">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                <a href="/admin" class="logout-btn">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</a>
            </div>

    <div class="container">
        <div class="header">
            <h1>üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p style="color: #666; margin-top: 10px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>

        <!-- Import Methods -->
        <div class="import-methods">
            <div class="method-card" onclick="selectMethod('excel')">
                <div class="method-icon">üìä</div>
                <div class="method-title">Excel / CSV</div>
                <div class="method-desc">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏´‡∏£‡∏∑‡∏≠ CSV (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</div>
            </div>

            <div class="method-card" onclick="selectMethod('api')">
                <div class="method-icon">üîå</div>
                <div class="method-title">API Integration</div>
                <div class="method-desc">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡∏ú‡πà‡∏≤‡∏ô REST API</div>
            </div>

            <div class="method-card" onclick="selectMethod('database')">
                <div class="method-icon">üóÑÔ∏è</div>
                <div class="method-title">Database</div>
                <div class="method-desc">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</div>
            </div>

            <div class="method-card" onclick="selectMethod('manual')">
                <div class="method-icon">‚úçÔ∏è</div>
                <div class="method-title">Manual Entry</div>
                <div class="method-desc">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏•‡∏∞‡∏Ñ‡∏ô (‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)</div>
            </div>
        </div>

        <!-- Excel/CSV Import -->
        <div id="excel-section" class="import-section">
            <h2 style="margin-bottom: 20px;">üìä ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å Excel / CSV</h2>
            
            <div class="alert alert-info">
                <strong>üìã ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå:</strong> ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå student_id, name, class_name<br>
                <a href="/api/download_template" style="color: #0c5460; text-decoration: underline; font-weight: bold;">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</a>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px;">üìù ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel/CSV:</h3>
                <table style="width: 100%; border-collapse: collapse; background: white;">
                    <thead>
                        <tr style="background: #667eea; color: white;">
                            <th style="padding: 12px; border: 1px solid #ddd;">student_id</th>
                            <th style="padding: 12px; border: 1px solid #ddd;">name</th>
                            <th style="padding: 12px; border: 1px solid #ddd;">class_name</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #ddd;">STD001</td>
                            <td style="padding: 12px; border: 1px solid #ddd;">‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ</td>
                            <td style="padding: 12px; border: 1px solid #ddd;">‡∏°.1/1</td>
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td style="padding: 12px; border: 1px solid #ddd;">STD002</td>
                            <td style="padding: 12px; border: 1px solid #ddd;">‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</td>
                            <td style="padding: 12px; border: 1px solid #ddd;">‡∏°.1/1</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #ddd;">STD003</td>
                            <td style="padding: 12px; border: 1px solid #ddd;">‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏Ç‡∏¢‡∏±‡∏ô</td>
                            <td style="padding: 12px; border: 1px solid #ddd;">‡∏°.1/2</td>
                        </tr>
                    </tbody>
                </table>
                <p style="margin-top: 15px; color: #666;">
                    üí° <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> 
                    <br>‚Ä¢ student_id = ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥)
                    <br>‚Ä¢ name = ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
                    <br>‚Ä¢ class_name = ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1/1, ‡∏õ.6/2)
                </p>
            </div>

            <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(event)">
                <div style="font-size: 3em; margin-bottom: 10px;">üìÅ</div>
                <div style="font-size: 1.2em; color: #667eea; font-weight: bold;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</div>
                <div style="color: #666; margin-top: 10px;">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: .xlsx, .xls, .csv</div>
            </div>

            <div id="previewSection" style="display: none; margin-top: 30px;">
                <h3>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <div style="overflow-x: auto;">
                    <table class="preview-table" id="previewTable"></table>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="importExcelData()">‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button class="btn btn-secondary" onclick="cancelImport()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
        </div>

        <!-- API Integration -->
        <div id="api-section" class="import-section">
            <h2 style="margin-bottom: 20px;">üîå API Integration</h2>
            
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡∏ó‡∏µ‡πà API Endpoint ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
            </div>

            <div class="form-group">
                <label>API Endpoint</label>
                <input type="text" class="form-control" value="http://localhost:5000/api/import/students" readonly>
            </div>

            <div class="form-group">
                <label>Method</label>
                <input type="text" class="form-control" value="POST" readonly>
            </div>

            <div class="form-group">
                <label>Request Body (JSON)</label>
                <div class="code-example">
                    <pre>{
  "students": [
    {
      "student_id": "STD001",
      "name": "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ",
      "class_name": "‡∏°.1/1",
      "image_base64": "optional_base64_string"
    }
  ]
}</pre>
                </div>
            </div>

            <div class="form-group">
                <label>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ (cURL)</label>
                <div class="code-example">
                    <pre>curl -X POST http://localhost:5000/api/import/students \
  -H "Content-Type: application/json" \
  -d '{"students": [...]}'</pre>
                </div>
            </div>

            <div class="form-group">
                <label>‡∏ó‡∏î‡∏™‡∏≠‡∏ö API</label>
                <textarea class="form-control" id="apiTestData" rows="10" placeholder='{"students": [{"student_id": "STD001", "name": "‡∏ó‡∏î‡∏™‡∏≠‡∏ö", "class_name": "‡∏°.1/1"}]}'></textarea>
            </div>

            <button class="btn" onclick="testApiImport()">üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API</button>
        </div>

        <!-- Database Connection -->
        <div id="database-section" class="import-section">
            <h2 style="margin-bottom: 20px;">üóÑÔ∏è ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
            
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:</strong> MySQL, PostgreSQL, SQL Server, Oracle
            </div>

            <div class="form-group">
                <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                <select class="form-control" id="dbType">
                    <option value="mysql">MySQL</option>
                    <option value="postgresql">PostgreSQL</option>
                    <option value="sqlserver">SQL Server</option>
                    <option value="oracle">Oracle</option>
                </select>
            </div>

            <div class="form-group">
                <label>Host</label>
                <input type="text" class="form-control" id="dbHost" placeholder="localhost">
            </div>

            <div class="form-group">
                <label>Port</label>
                <input type="text" class="form-control" id="dbPort" placeholder="3306">
            </div>

            <div class="form-group">
                <label>Database Name</label>
                <input type="text" class="form-control" id="dbName" placeholder="school_db">
            </div>

            <div class="form-group">
                <label>Username</label>
                <input type="text" class="form-control" id="dbUser" placeholder="root">
            </div>

            <div class="form-group">
                <label>Password</label>
                <input type="password" class="form-control" id="dbPassword">
            </div>

            <div class="form-group">
                <label>SQL Query</label>
                <textarea class="form-control" id="dbQuery" rows="5" placeholder="SELECT student_id, name, class_name FROM students"></textarea>
            </div>

            <button class="btn" onclick="testDbConnection()">üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
            <button class="btn" onclick="importFromDb()">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>

        <!-- Manual Entry -->
        <div id="manual-section" class="import-section">
            <h2 style="margin-bottom: 20px;">‚úçÔ∏è ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</h2>
            
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡∏•‡∏∞‡∏Ñ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ
            </div>

            <div style="text-align: center; padding: 40px;">
                <div style="font-size: 3em; margin-bottom: 20px;">üì∏</div>
                <p style="font-size: 1.2em; color: #666; margin-bottom: 20px;">
                    ‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥
                </p>
                <a href="/register" class="btn">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‚Üí</a>
            </div>
        </div>

        <div id="resultMessage"></div>
    </div>
        </div>
    </div>

    <script>
        let currentMethod = null;
        let importData = [];

        function selectMethod(method) {
            // Remove active class from all cards
            document.querySelectorAll('.method-card').forEach(card => {
                card.classList.remove('active');
            });

            // Hide all sections
            document.querySelectorAll('.import-section').forEach(section => {
                section.classList.remove('active');
            });

            // Activate selected method
            event.target.closest('.method-card').classList.add('active');
            document.getElementById(method + '-section').classList.add('active');
            currentMethod = method;
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            showMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå...', 'info');

            fetch('/api/import/preview', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    importData = data.students;
                    displayPreview(data.students);
                    showMessage(`‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${data.students.length} ‡∏Ñ‡∏ô`, 'success');
                } else {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            });
        }

        function displayPreview(students) {
            const table = document.getElementById('previewTable');
            let html = '<thead><tr><th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏´‡πâ‡∏≠‡∏á</th></tr></thead><tbody>';
            
            students.slice(0, 10).forEach(student => {
                html += `<tr>
                    <td>${student.student_id}</td>
                    <td>${student.name}</td>
                    <td>${student.class_name || '-'}</td>
                </tr>`;
            });
            
            if (students.length > 10) {
                html += `<tr><td colspan="3" style="text-align: center; color: #666;">... ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å ${students.length - 10} ‡∏Ñ‡∏ô</td></tr>`;
            }
            
            html += '</tbody>';
            table.innerHTML = html;
            document.getElementById('previewSection').style.display = 'block';
        }

        function importExcelData() {
            if (importData.length === 0) {
                showMessage('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤', 'error');
                return;
            }

            showMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');

            fetch('/api/import/students', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({students: importData})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(`‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${data.imported} ‡∏Ñ‡∏ô`, 'success');
                    setTimeout(() => {
                        window.location.href = '/admin';
                    }, 2000);
                } else {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            });
        }

        function cancelImport() {
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('fileInput').value = '';
            importData = [];
        }

        function testApiImport() {
            const data = document.getElementById('apiTestData').value;
            
            try {
                JSON.parse(data);
            } catch (e) {
                showMessage('JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }

            showMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö API...', 'info');

            fetch('/api/import/students', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: data
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(`‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ ${data.imported} ‡∏Ñ‡∏ô`, 'success');
                } else {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            });
        }

        function testDbConnection() {
            const config = {
                type: document.getElementById('dbType').value,
                host: document.getElementById('dbHost').value,
                port: document.getElementById('dbPort').value,
                database: document.getElementById('dbName').value,
                user: document.getElementById('dbUser').value,
                password: document.getElementById('dbPassword').value
            };

            showMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', 'info');

            fetch('/api/import/test_db', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                } else {
                    showMessage('‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            });
        }

        function importFromDb() {
            const config = {
                type: document.getElementById('dbType').value,
                host: document.getElementById('dbHost').value,
                port: document.getElementById('dbPort').value,
                database: document.getElementById('dbName').value,
                user: document.getElementById('dbUser').value,
                password: document.getElementById('dbPassword').value,
                query: document.getElementById('dbQuery').value
            };

            showMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');

            fetch('/api/import/from_db', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(`‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${data.imported} ‡∏Ñ‡∏ô`, 'success');
                    setTimeout(() => {
                        window.location.href = '/admin';
                    }, 2000);
                } else {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            });
        }

        function showMessage(message, type) {
            const resultDiv = document.getElementById('resultMessage');
            resultDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                if (type !== 'info') {
                    resultDiv.innerHTML = '';
                }
            }, 5000);
        }
    </script>
</body>
</html>
