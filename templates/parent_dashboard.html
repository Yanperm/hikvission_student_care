<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á - Student Care</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Kanit', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .navbar { background: rgba(255,255,255,0.95); padding: 15px 0; margin-bottom: 30px; }
        .navbar .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        .logo { font-size: 24px; font-weight: 700; color: #667eea; }
        .nav-links { display: flex; gap: 20px; align-items: center; }
        .nav-links a { text-decoration: none; color: #333; font-weight: 500; padding: 8px 16px; border-radius: 8px; transition: all 0.3s; }
        .nav-links a:hover { background: #667eea; color: white; }
        .logout-btn { background: #f44336; color: white; border: none; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s; font-family: 'Kanit', sans-serif; }
        .logout-btn:hover { background: #d32f2f; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px 40px; }
        .header { text-align: center; padding: 40px 20px; color: white; }
        .header h1 { font-size: 48px; margin-bottom: 20px; }
        .card { background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .stat-card h3 { font-size: 48px; color: #667eea; margin: 10px 0; }
        .student-profile { display: flex; align-items: center; gap: 30px; background: #f8f9fa; padding: 30px; border-radius: 15px; margin-bottom: 20px; cursor: pointer; transition: all 0.3s; border: 3px solid transparent; }
        .student-profile:hover { border-color: #667eea; transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102,126,234,0.3); }
        .student-profile.active { border-color: #667eea; background: #e8eaf6; }
        .student-img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #667eea; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .status-present { color: #4CAF50; font-weight: 600; }
        .status-absent { color: #f44336; font-weight: 600; }
        .behavior-good { background: #d4edda; color: #155724; padding: 5px 15px; border-radius: 20px; }
        .behavior-warning { background: #fff3cd; color: #856404; padding: 5px 15px; border-radius: 20px; }
        .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 50px; cursor: pointer; font-weight: 600; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">üéì Student Care - ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</div>
            <div class="nav-links">
                <a href="/">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <a href="/features">üìã ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏£‡∏∞‡∏ö‡∏ö</a>
                <a href="/parent_dashboard">üë®üë©üëß Dashboard ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</a>
                <button class="logout-btn" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </nav>

    <div class="header">
        <h1>üë®üë©üëß Dashboard ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</h1>
        <p>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏ï‡∏£‡∏´‡∏•‡∏≤‡∏ô</p>
    </div>

    <div class="container">
        <div class="card">
            <h2>üë®üë©üëßüë¶ ‡∏ö‡∏∏‡∏ï‡∏£‡∏´‡∏•‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô ({{ students|length }} ‡∏Ñ‡∏ô)</h2>
            <p style="color: #666; margin-bottom: 20px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô</p>
            <div id="studentsContainer">
                {% if students %}
                    {% for student in students %}
                    <div class="student-profile {% if loop.first %}active{% endif %}" onclick="selectStudent('{{ student.student_id }}')" data-student-id="{{ student.student_id }}">
                        <img src="/student_image/{{ student.student_id }}" class="student-img" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Ccircle cx=%2260%22 cy=%2260%22 r=%2260%22 fill=%22%23ddd%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 font-size=%2250%22%3Eüë§%3C/text%3E%3C/svg%3E'">
                        <div>
                            <h3>{{ student.name }}</h3>
                            <p style="font-size: 16px; color: #666; margin: 5px 0;">‡∏£‡∏´‡∏±‡∏™: {{ student.student_id }}</p>
                            <p style="font-size: 16px; color: #666;">‡∏´‡πâ‡∏≠‡∏á: {{ student.class_name or '-' }}</p>
                            {% if student.has_line %}
                            <span style="color: #155724; font-weight: 600; font-size: 14px;">‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡πÅ‡∏•‡πâ‡∏ß</span>
                            {% else %}
                            <span style="color: #856404; font-weight: 600; font-size: 14px;">‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏ï‡∏£‡∏´‡∏•‡∏≤‡∏ô</h3>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <p>üìÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
                <h3 id="monthAttendance">0</h3>
                <p style="color: #666;">‡∏à‡∏≤‡∏Å 20 ‡∏ß‡∏±‡∏ô</p>
            </div>
            <div class="stat-card">
                <p>üìä ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                <h3 id="attendancePercent">0%</h3>
            </div>
            <div class="stat-card">
                <p>‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥</p>
                <h3 id="behaviorScore">100</h3>
                <p style="color: #666;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏° 100</p>
            </div>
        </div>

        <div class="card">
            <h2>üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h2>
            <table id="attendanceTable">
                <thead>
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                        <th>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="4" style="text-align: center;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>üëÅÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏° (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h2>
            <table id="behaviorTable">
                <thead>
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                        <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th>‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</th>
                        <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="4" style="text-align: center;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>üíö ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LINE Official Account</h2>
            <p style="margin-bottom: 20px;">‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏á LINE ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏ï‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #06C755; margin-bottom: 15px;">üì± ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å!):</h3>
                <ol style="margin-left: 20px; color: #666; line-height: 2;">
                    <li>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô LINE OA ‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏™‡πÅ‡∏Å‡∏ô QR Code)</li>
                    <li>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° <strong>"‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"</strong> (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: STD001) ‡πÑ‡∏õ‡∏ó‡∏µ‡πà LINE OA</li>
                    <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ß‡πà‡∏≤ <strong>"‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"</strong></li>
                    <li>‡πÄ‡∏™‡∏£‡πá‡∏à! ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                </ol>
                <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px;">
                    <strong>‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å LINE User ID ‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <h4>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠:</h4>
                <div style="margin-top: 15px;">
                    {% for student in students %}
                    <div style="padding: 15px; background: {% if student.has_line %}#d4edda{% else %}#f8f9fa{% endif %}; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>{{ student.name }}</strong> ({{ student.student_id }})<br>
                            <small style="color: #666;">‡∏´‡πâ‡∏≠‡∏á: {{ student.class_name or '-' }}</small>
                        </div>
                        <div>
                            {% if student.has_line %}
                            <span style="color: #155724; font-weight: 600;">‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß</span>
                            {% else %}
                            <span style="color: #856404; font-weight: 600;">‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px; border-left: 4px solid #2196F3;">
                <strong>üí° ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏ó‡πà‡∏≤‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏á LINE ‡πÄ‡∏°‡∏∑‡πà‡∏≠:
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>üü¢ ‡∏ö‡∏∏‡∏ï‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</li>
                    <li>üü† ‡∏ö‡∏∏‡∏ï‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</li>
                    <li>‚ö†Ô∏è ‡∏ö‡∏∏‡∏ï‡∏£‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</li>
                    <li>üìù ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let currentStudentId = {% if students %}'{{ students[0].student_id }}'{% else %}null{% endif %};

        function logout() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
                window.location.href = '/logout';
            }
        }

        function selectStudent(studentId) {
            currentStudentId = studentId;
            
            // Update active state
            document.querySelectorAll('.student-profile').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`[data-student-id="${studentId}"]`).classList.add('active');
            
            // Reload data
            loadData();
        }

        async function loadData() {
            if (!currentStudentId) return;
            
            try {
                // Load attendance and behavior
                const res = await fetch(`/api/student/${currentStudentId}`);
                if (res.ok) {
                    const data = await res.json();
                    const attendance = data.attendance || [];
                    const behaviors = data.behaviors || [];
                    
                    document.getElementById('monthAttendance').textContent = attendance.length;
                    document.getElementById('attendancePercent').textContent = Math.round((attendance.length / 20) * 100) + '%';
                    
                    const attendanceTbody = document.querySelector('#attendanceTable tbody');
                    if (attendance.length === 0) {
                        attendanceTbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                    } else {
                        attendanceTbody.innerHTML = attendance.slice(0, 7).map(a => `
                            <tr>
                                <td>${new Date(a.timestamp).toLocaleDateString('th-TH')}</td>
                                <td>${new Date(a.timestamp).toLocaleTimeString('th-TH')}</td>
                                <td><span class="status-present">‚úÖ ${a.status || 'present'}</span></td>
                                <td>${a.camera_type === 'classroom' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' : '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}</td>
                            </tr>
                        `).join('');
                    }
                    
                    // Load behavior
                    const behaviorTbody = document.querySelector('#behaviorTable tbody');
                    if (behaviors.length === 0) {
                        behaviorTbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</td></tr>';
                    } else {
                        behaviorTbody.innerHTML = behaviors.slice(0, 7).map(b => `
                            <tr>
                                <td>${new Date(b.timestamp).toLocaleDateString('th-TH')}</td>
                                <td>${new Date(b.timestamp).toLocaleTimeString('th-TH')}</td>
                                <td>${b.behavior}</td>
                                <td><span class="${b.severity === 'warning' || b.severity === 'danger' ? 'behavior-warning' : 'behavior-good'}">${b.severity === 'warning' || b.severity === 'danger' ? '‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°' : '‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥'}</span></td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        loadData();
        setInterval(loadData, 60000);
    </script>
</body>
</html>
